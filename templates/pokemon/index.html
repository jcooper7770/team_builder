{% extends "pokemon/base.html" %}

{% block content %}
<script type="text/javascript">
function fillPokemonCharts(data, chartId, poke_win_rates) {
  const chartElement = document.getElementById(chartId);

  for(let i=0; i< data.length; i++) {
    // outer div
    const outerDiv = document.createElement("div");
    outerDiv.className = "pokemon-chart-container";
    
    const pokemonData = data[i];
    if (pokemonData[1] < {{min_percentage}}) {
      continue;
    }
    
    // first row
    const firstRowDiv = document.createElement("div");
    firstRowDiv.className = "row";

    const firstColDiv = document.createElement("div");
    firstColDiv.className = "col-6";

    const pieChart = document.createElement("div");
    pieChart.className = "pie";
    pieChart.style.setProperty("--p", pokemonData[1]);
    pieChart.style.setProperty("--b", "10px");
    pieChart.style.setProperty("--w", "100%");

    const percentDiv = document.createElement("div");
    percentDiv.className = "percentage";
    percentDiv.innerText = `${Number(pokemonData[1]).toFixed(2)}%`;
    pieChart.appendChild(percentDiv);
    firstColDiv.appendChild(pieChart);
  
    const secondColDiv = document.createElement("div");
    secondColDiv.className = "pokemon-image-container col-6";
   
    var content = '';
    if (pokemonData[0].includes("shadow")) {
      const pokemonName = pokemonData[0].slice(0, -7);
      content = `<div style="position: relative;">
        <img src="/images/pokemon_images/${pokemonName}.png" class="pokemon-image" style="z-index: 2; position: relative;" alt="${pokemonData[0]}">
        <img src="/images/shadow_fire.png" style="max-width: 100%; max-height: 50px; position: absolute; left: 0px; bottom: 10px;">
      </div>`
    } else {
      content = `<img src="/images/pokemon_images/${pokemonData[0]}.png" class="pokemon-image" alt="${pokemonData[0]}" >`
    }
    secondColDiv.innerHTML = content;
    firstRowDiv.appendChild(firstColDiv);
    firstRowDiv.appendChild(secondColDiv);

    const secondRowDiv = document.createElement("div");
    secondRowDiv.className = "clearfix text-center";
    var rowContent1 =  `<p style="margin: 0px;"><b>${pokemonData[0]}</b></p>`; // TODO: convert to title case

    var rowContent2 = ``;
    if (poke_win_rates[pokemonData[0]]) {
      rowContent2 = `<p style="font-size: 10px; margin: 0px;">(${poke_win_rates[pokemonData[0]]})</p>`;
    } else {
      rowContent2 = `<p></p>`;
    }
    secondRowDiv.innerHTML = rowContent1 + rowContent2;
    
    outerDiv.appendChild(firstRowDiv);
    outerDiv.appendChild(secondRowDiv);

    chartElement.appendChild(outerDiv);
  }
}

function toggleAdvOptions(e) {
  e.preventDefault();
  const advOptions = document.getElementById('advanced-options');
  const caret = document.getElementById('caret-advanced-options')

  if (advOptions.style.display == "none") {
    advOptions.style.display = "";
    caret.className = "fa fa-caret-up"
  } else {
    advOptions.style.display = "none";
    caret.className = "fa fa-caret-down"
  }
}


</script>

<div class="outside">
  <div class="options-menu">
    <button class="options-menu-button my-auto">Options <i class="fa fa-angle-double-right"></i></button>
    <button class="options-close-button my-auto"><i class="fa fa-times" aria-hidden="true"></i></button>
    <div style="clear:both;"></div>
    <div class="container">
      <form action="/">
      <table border=1 align="center" class="table table-striped table-sm">
        <thead class="thead-dark">
          <th colspan=2>Options</th>
        </thead>
        <tbody>
          <tr>
            <td>
              <button class="btn btn-secondary w-100" id='btn-advanced-options' onclick="toggleAdvOptions(event)">Advanced <i id="caret-advanced-options" class="fa fa-caret-down"></i></button>
            </td>
          </tr>
          <tr style="display: none;" id="advanced-options">
            <td>
              Min Percentage:
              <input type="number" min="1" step="1" id="min_percentage" value="{{min_percentage}}" name="min_percentage" class="form-control" />
              Calculation Exponent:
              <input type="number" min="1" max="3" step="1" id="exponent" value="{{exponent or 1}}" name="exponent" class="form-control" />
              <button class="btn btn-warning w-100" id="refresh-league-data">Refresh League Data</button>
              <br>Last refreshed: {{ last_refreshed }}
            </td>
          </tr>
          <tr>
            <td align="center">League:</td>
          </tr>
          <tr>
            <td>
            <select id="league_picker" name="league" class="form-control">
              {% for league in split_leagues %}
              <optgroup label="{{ league[0] }}">
                {% for cup in league[1] %}
                <option value="{{cup[0]}}" id="option_{{cup[0]}}"{% if current_league==cup[0] %} selected{% endif %}>{{cup[0]}}</option>
                {% endfor %}
              </optgroup>
              {% endfor %}
            </select>
            </td>
          </tr>
          <tr>
            <td align="center">Create team from pokemon:</td>
          </tr>
          <tr>
            <td>
            <select id="mySelect" name="pokemon" class="form-control">
              <option value="">None</option>
            {% for pokemon in all_pokemon %}
              <option value='{{pokemon.speciesId}}'{% if current_pokemon == pokemon.speciesId %} selected{% endif %}>{{pokemon.speciesId}}</option>
            {% endfor %}
            </select>
            <input type='radio' id='lead' value='lead' name='position' {% if chosen_position=="lead" %} checked {% endif %}><label for='lead'>In the lead</label>
            <br><input type='radio' id='back' value='back' name='position' {% if chosen_position=="back" %} checked {% endif %}><label for='back'>In the back</label>
            </td>
          </tr>
          <tr>
            <td align="center">Time Range of Data (in days):</td>
          </tr>
          <tr>
            <td>
              <div style="display: flex; flex-direction: row; justify-content: space-between;">
                <div id="from-section" style="display: flex; flex-direction: column; width: 40%;" class="text-center">
                  <p>From:</p>
                  <input type="number" min="1" step="1" id="num_days_start" value="{{num_days_start}}" name="num_days_start" class="form-control w-40" />
                </div>
                <div id="from-section" style="display: flex; flex-direction: column; width: 40%;" class="text-center">
                  <p>To:</p>
                  <input type="number" min="0" step="1" id="num_days_end" value="{{num_days_end}}" name="num_days_end" class="form-control w-40" />
                </div>
              </div>
            </td>
          </tr>
          <tr>
            <td align="center">Rating:</td>
          </tr>
          <tr>
            <td>
              <select id="rating" name="rating" class="form-control">
                <option value="None">None</option>
                {% for rating in ratings %}
                <option value="{{rating}}"{% if rating == current_rating %} selected{% endif %}>{{rating}}</option>
                {% endfor %}
              </select>
            </td>
          </tr>
          <tr>
            <td align="center">Number of recommended teams:</td>
          </tr>
          <tr>
            <td>
              <input type="number" min="1" step="1" id="num_teams" value="{{number_teams}}" name="num_teams" class="form-control" />
            </td>
          </tr>
          <tr>
            <td colspan=2 align="right"><button id="submit-button" type="submit" class="btn btn-primary w-100">Submit</button></td>
          </tr>
        </tbody>
      </table>
      </form>
    </div>
  </div>

  <div class="main-content"></div>

  <!-- Tabs at bottom-->
  <div class="bottom-tabs">
    <!--<ul class="nav nav-tabs fixed-bottom bg-dark color-changing">-->
    <ul class="nav nav-tabs fixed-bottom color-changing">
      <li class="nav-item">
        <a class="nav-link active" data-toggle="tab" href="#meta-tab">Meta Data</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" data-toggle="tab" href="#teams-tab">Top Teams</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" data-toggle="tab" href="#recc-tab">Recommended Teams</a>
      </li>
    </ul>
  </div>

  <div class="tab-content">
    <div id="meta-tab" class="tab-pane fade show active">
      <div>
        <p align="center" class="clear-header" style="margin:0px; text-decoration: none; border-bottom: 1px solid white; font-size: 20px;">Meta Data</p>
        <div class="border-dark meta-table">
          <nav class="clear-header">
            <ul class="nav nav-tabs" id="pokemon-position" role="tablist">
              <li class="nav-item">
                <a class="nav-link active" href="#nav-leads" id="nav-leads-tab" data-toggle="tab" aria-controls="nav-leads"
                  role="tab" aria-selected="true">Leads</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#nav-ss" id="nav-ss-tab" data-toggle="tab" aria-controls="nav-ss" role="tab"
                  aria-selected="false">Second</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#nav-back" id="nav-back-tab" data-toggle="tab" aria-controls="nav-back" role="tab"
                  aria-selected="false">Third</a>
              </li>
              <li class="nav-item ml-auto">
                <p class="nav-link" style="">Using <b>{{ n_teams }}</b> teams of data</p>
              </li>
            </ul>
          </nav>
      <div class="p-0">
        <div class="tab-content">
          <!-- Leads Tab -->
          <div class="tab-pane fade show active" id="nav-leads" role="tabpanel" aria-labelledby="nav-leads-tab">
            <table class="my-0 table-striped" border="1" style="background-color: white;">
              <thead class="clear-header">
                <th colspan="2" class="text-center">Leads</th>
              </thead>
              <tbody>
                <tr>
                  <td style="width:50%">
                    <b>Leads reported on GoBattleLog</b>
                    <br>
                    <p>The number of times the pokemon is reported as first on a team by trainers using GoBattleLog.</p>
                    <p>In parentheses is the pokemon's actual win rate in the lead.</p>
                    <p style="margin: 0px"><a href='/move_image?pokemon={{lead_move_count_string}}' class="btn btn-primary" style="width: 100%">Download move counts</a></p>
                  </td>
                  <td>
                    <b>Leads that beat the meta leads</b>
                    <br>
                    <p>Weighted percent of the leads (on the left) that the pokemon beats (using a 1-1 shield scenario).</p>
                    <p>In parentheses is the pokemon's actual win rate in the lead.</p>
                  </td>
                </tr>
                <tr class="data-row">
                  <td>
                    <div class="data2" style="">
                      <table style="width: 100%;">
                        <tr style="border:none;">
                          <td style="border:none;padding-top:1px;padding-bottom:0px"><b><u>Pokemon</u></b></td>
                          <td style="border:none;padding-top:1px;padding-bottom:0px"><b><u># Reports</u></b></td>
                        </tr>
                      {% for lead in result_data.meta_leads %}
                        <tr style="border:none;">
                          <td style="border:none;padding-top:1px;padding-bottom:0px;overflow: visible;">
                            {{ lead[0] | pokemonColor(current_pokemon, current_league) | safe }} ({{poke_win_rates['leads'][lead[0]]}})
                            <!--{{ lead[0] }}-->
                          </td>
                          <td style="border:none;padding-top:1px;padding-bottom:0px">
                            {{ lead[1] }}
                          </td>
                        </tr>
                      {% endfor %}
                      </table>
                    </div>
                  </td>
                  <td>
                    <div class="data2" style="">
                      <table border="0" style="width: 100%; display: none;">
                        <tr style="border:none;">
                          <td style="border:none;padding-top:1px;padding-bottom:0px"><b><u>Pokemon</u></b></td>
                          <td style="border:none;padding-top:1px;padding-bottom:0px"><b><u>Predicted win rate</u></b></td>
                        </tr>
                      {% for lead in result_data.good_leads %}
                        {% if lead[1] >= min_percentage %}
                        <tr border="0">
                          <td style="border:none;padding-top:1px;padding-bottom:0px">
                            {{ lead[0] | pokemonColor(current_pokemon, current_league) | safe }} ({{poke_win_rates['leads'][lead[0]]}})
                            <!--{{ lead[0] }}-->
                          </td>
                          <td style="border:none;padding-top:1px;padding-bottom:0px">
                            {{ "%.2f" | format(lead[1]) }}%
                          </td>
                        </tr>
                        {% endif %}
                      {% endfor %}
                      </table>
                      <div class="all-pokemon-charts" id="pokemon-lead-charts">
                        <script type="text/javascript">
                          fillPokemonCharts({{result_data.good_leads | tojson | safe}}, 'pokemon-lead-charts', {{poke_win_rates["leads"] | tojson | safe}});
                        </script>
                      </div>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <!-- Second pokemon Tab -->
          <div class="tab-pane fade" id="nav-ss" role="tabpanel" aria-labelledby="nav-ss-tab">
            <table class="my-0 table-striped" border="1" style="background-color: white;">
              <thead class="clear-header">
                <th colspan="2" class="text-center">Second Pokemon</th>
              </thead>
              <tbody>
                <tr>
                  <td style="width:50%">
                    <b>Second pokemon reported on GoBattleLog</b>
                    <br>
                    <p>The number of times the pokemon is reported as the second pokemon on a team by trainers using GoBattleLog.</p>
                    <p>In parentheses is the pokemon's actual win rate in the second position.</p>
                    <p style="margin: 0px;"><a href='/move_image?pokemon={{ss_move_count_string}}' class="btn btn-primary" style="width: 100%">Download move counts</a></p>
                  </td>
                  <td>
                    <b>Second pokemon that beat the meta second pokemon</b>
                    <br>
                    <p>Weighted percent of the second pokemon (on the left) that the pokemon beats (using a 1-1 shield scenario).</p>
                    <p>In parentheses is the pokemon's actual win rate in the second position.</p>
                  </td>
                </tr>
                <tr class="data-row">
                  <td>
                    <div class="data2" style="">
                      <table border="0" style="width: 100%">
                        <tr style="border:none;">
                          <td style="border:none;padding-top:1px;padding-bottom:0px"><b><u>Pokemon</u></b></td>
                          <td style="border:none;padding-top:1px;padding-bottom:0px"><b><u># Reports</u></b></td>
                        </tr>
                      {% for ss in result_data.meta_ss %}
                        <tr style="border:none;">
                          <td style="border:none;padding-top:1px;padding-bottom:0px">
                            {{ ss[0] | pokemonColor(current_pokemon, current_league) | safe }} ({{poke_win_rates['ss'][ss[0]]}})
                          </td>
                          <td style="border:none;padding-top:1px;padding-bottom:0px">
                            {{ ss[1] }}
                          </td>
                        </tr>
                      {% endfor %}
                      </table>
                    </div>
                  </td>
                  <td>
                    <div class="data2" style="">
                      <table border="0" style="width: 100%; display: none;">
                        <tr style="border:none;">
                          <td style="border:none;padding-top:1px;padding-bottom:0px"><b><u>Pokemon</u></b></td>
                          <td style="border:none;padding-top:1px;padding-bottom:0px"><b><u>Predicted win rate</u></b></td>
                        </tr>
                      {% for ss in result_data.good_ss %}
                        {% if ss[1] >= min_percentage %}
                        <tr border="0">
                          <td style="border:none;padding-top:1px;padding-bottom:0px">
                            {{ ss[0] | pokemonColor(current_pokemon, current_league) }} ({{poke_win_rates['ss'][ss[0]]}})
                          </td>
                          <td style="border:none;padding-top:1px;padding-bottom:0px">
                            {{ "%.2f" | format(ss[1]) }}%
                          </td>
                        </tr>
                        {% endif %}
                      {% endfor %}
                      </table>
                      <div class="all-pokemon-charts" id="pokemon-ss-charts">
                        <script type="text/javascript">
                          fillPokemonCharts({{result_data.good_ss | tojson | safe}}, 'pokemon-ss-charts', {{poke_win_rates["ss"] | tojson | safe}});
                        </script>
                      </div>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <!-- Third pokemon Tab -->
          <div class="tab-pane fade" id="nav-back" role="tabpanel" aria-labelledby="nav-back-tab">
            <table class="my-0 table-striped" border="1" style="background-color: white;">
              <thead class="clear-header">
                <th colspan="2" class="text-center">Third Pokemon</th>
              </thead>
              <tbody>
                <tr>
                  <td style="width:50%">
                    <b>Third pokemon reported on GoBattleLog</b>
                    <br>
                    <p>The number of times the pokemon is reported as last on a team by trainers using GoBattleLog.</p>
                    <p>In parentheses is the pokemon's actual win rate in the third position.</p>
                    <p style="margin: 0px;"><a href='/move_image?pokemon={{back_move_count_string}}' class="btn btn-primary" style="width: 100%">Download move counts</a></p>
                  </td>
                  <td>
                    <b>Third pokemon that beat the meta third pokemon</b>
                    <br>
                    <p>Weighted percent of the third pokemon (on the left) that the pokemon beats (using a 1-1 shield scenario).</p>
                    <p>In parentheses is the pokemon's actual win rate in the third position.</p>
                  </td>
                </tr>
                <tr class="data-row">
                  <td>
                    <div class="data2" style="">
                      <table border="0" style="width: 100%">
                        <tr style="border:none;">
                          <td style="border:none;padding-top:1px;padding-bottom:0px"><b><u>Pokemon</u></b></td>
                          <td style="border:none;padding-top:1px;padding-bottom:0px"><b><u># Reports</u></b></td>
                        </tr>
                      {% for back in result_data.meta_backs %}
                        <tr style="border:none;">
                          <td style="border:none;padding-top:1px;padding-bottom:0px">
                            {{ back[0] | pokemonColor(current_pokemon, current_league) }} ({{ poke_win_rates['back'][back[0]]}})
                          </td>
                          <td style="border:none;padding-top:1px;padding-bottom:0px">
                            {{ back[1] }}
                          </td>
                        </tr>
                      {% endfor %}
                      </table>
                    </div>
                  </td>
                  <td>
                    <div class="data2" style="">
                      <table border="0" style="width: 100%; display: none;">
                        <tr style="border:none;">
                          <td style="border:none;padding-top:1px;padding-bottom:0px"><b><u>Pokemon</u></b></td>
                          <td style="border:none;padding-top:1px;padding-bottom:0px"><b><u>Predicted win rate</u></b></td>
                        </tr>
                      {% for back in result_data.good_backs %}
                        {% if back[1] >= min_percentage %}
                        <tr border="0">
                          <td style="border:none;padding-top:1px;padding-bottom:0px">
                            {{ back[0] | pokemonColor(current_pokemon, current_league) }} ({{ poke_win_rates['back'][back[0]]}})
                          </td>
                          <td style="border:none;padding-top:1px;padding-bottom:0px">
                            {{ "%.2f" | format(back[1]) }}%
                          </td>
                        </tr>
                        {% endif %}
                      {% endfor %}
                      </table>
                      <div class="all-pokemon-charts" id="pokemon-back-charts">
                        <script type="text/javascript">
                          fillPokemonCharts({{result_data.good_backs | tojson | safe}}, 'pokemon-back-charts', {{poke_win_rates["back"] | tojson | safe}});
                        </script>
                      </div>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div> 
      </div>
    </div>
    <div id="teams-tab" class="tab-pane fade">
      <br><br>
      <div class="container">
      <div id="top-used-teams-header" class="clear-header" >
        <div id="title" class="text-center w-100 font-weight-bold">Top Used Teams</div>
        <div id="searchbar" class="mx-auto" >
          <button id="team-search-button" class="bg-white"><i class="fa fa-search bg-white"></i></button>
          <input type="text" id="team-search-input" placeholder="Search for Pokemon">
        </div>
      </div>
      <a class="btn btn-primary" href="/move_image?pokemon={{teams_move_count_string}}&cols=10" target="_blank" style="width: 100%; border-radius: 0">Download move counts</a>
   
      <div id="teams-section">
        <div id="teams-section-header" class="clear-header text-center">
          <div id="team">Team</div>
          <div id="wr">Win Rate</div>
        </div>
        {% for team in team_win_rates %}
        {% if "/1 ||" not in team[1] %}
        <div>
          <div id="team-col" class="fa fa-caret-down">
            {{ team[0] }}
            <span style="display: none; opacity: 0; transition: all 1s ease">
              <br>Counters: {{ team_counters[team[0]] }}
              {% for pokemon in team[2] %}
              <table border="1" class="mx-auto">
                <tr><th colspan="2" class="text-center">{{ pokemon }}</th></tr>
                {% for move in team[2][pokemon] %}
                <tr>
                  <td>{{ move }}</td>
                  <td>{{ team[2][pokemon][move] }}</td>
                </tr>
                {% endfor %}
              </table>
              <br>
              {% endfor %}
            </span>
          </div>
          <div id="wr">{{ team[1] }}</div>
        </div>
        {% endif %}
        {% endfor %}
      </div>
    </div>
    </div>
    <div id="recc-tab" class="tab-pane fade">
      {{body|safe}}
    </div>
  </div>
  <br><br>
  <br><br>

  </div>
</div>
<script src="https://code.jquery.com/jquery-3.5.1.js"
          integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc="
          crossorigin="anonymous"></script>

<script type="text/javascript">
const num_start_input = document.getElementById("num_days_start");
const num_end_input = document.getElementById("num_days_end");
num_start_input.addEventListener('input', () => {
  if (parseInt(num_start_input.value) <= parseInt(num_end_input.value)) {
    num_start_input.value = parseInt(num_end_input.value) + 1;
  }
});
num_end_input.addEventListener('input', () => {
  if (parseInt(num_end_input.value) >= parseInt(num_start_input.value)) {
    num_end_input.value = parseInt(num_start_input.value) - 1;
  }
});

var slideMainContent = false; // make main content slide over for menu
var refreshOnLeagueChange = false; // refresh data if league picker is changed
// Fix for showing tooltips inside of a overflow scrollable div
$("a.tooltip1").hover(function() {
  $(this).addClass("hover");
  $(this).parent().parent().parent().parent().parent().css("overflow-y", "visible");
  $(this).parent().parent().parent().parent().parent().css("overflow-x", "visible");
}, function() {
  $(this).removeClass("hover");
  $(this).parent().parent().parent().parent().parent().css("overflow-y", "auto");
  $(this).parent().parent().parent().parent().parent().css("overflow-x", "auto");
});

// Pull new data from gobattlelog for the league and refresh
$("#refresh-league-data").click(function (e){
  // Get current league
  var league = $("#league_picker").val();
  alert("Refreshing data for: " + league);
  // POST to refresh data
  var spinnercontainer = document.querySelector(".spinner-container");
  spinnercontainer.style.display = "flex";
  $.post("/data/refresh", {
    league: league
  },
  function(data, status){
  });
  location.reload();
});

// Refreshes once a new league is chosen
$("#league_picker").change(function(e){
  if (refreshOnLeagueChange) {
    var league= $(this).val();
    var chosen_pokemon = $("#mySelect").val();
    var num_days = $("#num_days").val();
    alert("Reloading page for " + league + " league");
    var spinnercontainer = document.querySelector(".spinner-container");
    spinnercontainer.style.display = "flex";
    location.href = "?league="+league+"&pokemon="+chosen_pokemon+"&num_days="+num_days;
  }
});

var submit = document.getElementById("submit-button");
submit.addEventListener("click", function() {
  var spinnercontainer = document.querySelector(".spinner-container");
  spinnercontainer.style.display = "flex";
});

// show spinner on reload
window.onbeforeunload = function(e) {
  var spinnercontainer = document.querySelector(".spinner-container");
  spinnercontainer.style.display = "flex";
}
$(document).ready(function () {
  var spinnercontainer = document.querySelector(".spinner-container");
  spinnercontainer.style.display = "none";
  console.log("Done loading");
});
window.onload = function(e) {
}

// options menu
const menuButton = document.querySelector('.options-menu-button');
const closeButton = document.querySelector('.options-close-button');
const menu = document.querySelector('.options-menu');
const content = document.querySelector('.main-content');

menuButton.addEventListener('click', function() {
  menu.classList.toggle('open');
  menuButton.classList.toggle('open');
  if (slideMainContent){
    content.classList.toggle('open');
  }
  // change icon
  document.querySelector('.options-menu-button i').classList = "fa fa-angle-double-left";
});
closeButton.addEventListener('click', function() {
  menu.classList.toggle('open');
  menuButton.classList.toggle('open');

  if (slideMainContent){
    content.classList.toggle('open');
  }
  // change icon
  document.querySelector('.options-menu-button i').classList = "fa fa-angle-double-right";
});
const navbar = document.querySelector('.navbar');
const optionsMenu = document.querySelector('.options-menu');

optionsMenu.style.top = navbar.getBoundingClientRect().height + 'px';

// Teams search feature
const searchButton = document.getElementById("team-search-button");
const searchInput = document.getElementById("team-search-input");
searchButton.addEventListener("click", function(e){
  e.preventDefault();
  var rowNum = 0;
  const searchValues = searchInput.value.split(" ");
  document.querySelectorAll("#teams-section > div").forEach((elem) => {
    if (elem.id !="teams-section-header") {
      elem.style.display = "none";

      var rowText = elem.children[0].innerText;
      var contains = false;
      for(var i=0; i < searchValues.length; i++ ) {
        var andTerms = searchValues[i].split("&");
        var termMatches = true;
        for (var j=0; j < andTerms.length; j++) {
          if (rowText.toLowerCase().indexOf(andTerms[j].toLowerCase()) === -1) {
            termMatches = false;
            break;
          }
        }
        if(termMatches) {
          contains = true;
          break;
        }
      }

      if (!contains) {
        elem.style.display = "none";
      } else {
        elem.style.display = "";
        rowNum ++;
        if (rowNum % 2 == 0) {
          elem.style.background = "#FFFFFF";
        } else {
          elem.style.background = "#F0F0F0";
        }
      }
    }
  });
});

// Clicking on team column opens up move counts
$("[id^=team-col]").click(function(e) {
  // Find the team-col div from whatever was clicked on
  var target = e.target;
  var hiddenElement = e.target.children[0]
  if (e.target.tagName != "DIV") {
    target = e.target.closest("div");
    hiddenElement = target.children[0];
  }
  e.preventDefault();

  // Toggle hiding/showing the move counts
  if (hiddenElement.style.display == "none") {
    hiddenElement.style.display = "";
    hiddenElement.style.opacity = "1";
    target.className = "fa fa-caret-up";
  } else {
    hiddenElement.style.display = "none";
    hiddenElement.style.opacity = "0";
    target.className = "fa fa-caret-down";
  }
});
</script>
{% endblock %}